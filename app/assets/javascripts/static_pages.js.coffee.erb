# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://coffeescript.org/
$(document).ready ->
  
  #set opacity to 0.4 for all the images  
  #opacity = 1 - completely opaque  
  #opacity = 0 - invisible  
  $(".menu-custom img").css "opacity", 0.4
  
  # when hover over the selected image change the opacity to 1  
  $(".menu-custom li").hover (->
    $(this).find("img").stop().fadeTo "slow", 1
  ), ->
    $(this).find("img").stop().fadeTo "slow", 0.4

  $('#guardar-cambios-customapp').click (event) ->
    guardar_cambios()
  $('#actualiza-customapp').click (event) ->
    actualizar_custom()
    #    alert($("#per-est-app").attr('src'))
  if gon.archivos!=undefined
    cargar_cambios gon.archivos

  setTimeout (->
    $("#flash").fadeTo 'slow', 0, ->
      $("#flash").remove()
    ), 5000

$().ready ->
  $('.kwicks').kwicks
    maxSize: 100
    behavior: 'menu'
  $('.kwicks li').click (event) ->
    ele = document.getElementById(event.target.id)
    color = $(ele).css('background-color')
    col = new RGBColor(color)
    colhex = col.toHex_n()
    parte = event.target.id.charAt(6)

    switch parte
     when '0'
       changeEstanque colhex
     when '1'
       changeAplicacion colhex
     when '2'
       changeAsiento colhex
     when '3'
       changeManilla colhex

    #Usando la clase RGB color incluida en assets
    return
  return

changeEstanque = (color) ->
  $.ajax
          type: 'POST'
          url: "fetch_estanque"
          data:
            selected_value: color
            parte: 'estanque'
          dataType: "json"
          success: (data) ->
            nuevaParte '#per-est-app', data.per
            nuevaParte '#lat-est-app', data.lat
            nuevaParte '#sup-est-app', data.sup
  return

changeAplicacion = (color) ->
  $.ajax
          type: 'POST'
          url: "fetch_aplicacion"
          data:
            selected_value: color
            parte: 'aplicacion'
          dataType: "json"
          success: (data) ->
            nuevaParte '#per-apl-app', data.per
            nuevaParte '#lat-apl-app', data.lat
          # En la vista superior la aplicaciÃ³n del estanque no tiene visualizaciÃ³n.
  return

changeAsiento = (color) ->
  $.ajax
          type: 'POST'
          url: "fetch_asiento"
          data:
            selected_value: color
            parte: 'asiento'
          dataType: "json"
          success: (data) ->
            nuevaParte '#per-asi-app', data.per
            nuevaParte '#lat-asi-app', data.lat
            nuevaParte '#sup-asi-app', data.sup
  return

changeManilla = (color) ->
  $.ajax
          type: 'POST'
          url: "fetch_manilla"
          data:
            selected_value: color
            parte: 'manilla'
          dataType: "json"
          success: (data) ->
            nuevaParte '#per-man-app', data.per
            nuevaParte '#lat-man-app', data.lat
            nuevaParte '#sup-man-app', data.sup
  return

nuevaParte = (parte, data_src) ->
  $(parte).fadeOut "fast", ->
    $(this).load ->
      $(this).fadeIn("slow")
    $(parte).attr src: data_src

guardar_cambios = ->
  $.ajax
          type: 'POST'
          url: custompath #variable definida en _customapp.html.erb con el path para crear una nueva CustomApp 
          data:
            custom_app:
              est_per_file: $("#per-est-app").attr('src')
              est_lat_file: $("#lat-est-app").attr('src')
              est_sup_file: $("#sup-est-app").attr('src')
              apl_per_file: $("#per-apl-app").attr('src')
              apl_lat_file: $("#lat-apl-app").attr('src')
              apl_sup_file: $("#sup-apl-app").attr('src')
              asi_per_file: $("#per-asi-app").attr('src')
              asi_lat_file: $("#lat-asi-app").attr('src')
              asi_sup_file: $("#sup-asi-app").attr('src')
              man_per_file: $("#per-man-app").attr('src')
              man_lat_file: $("#lat-man-app").attr('src')
              man_sup_file: $("#sup-man-app").attr('src')
              lla_per_file: $("#per-lla-app").attr('src')
              lla_lat_file: $("#lat-lla-app").attr('src')
              lla_sup_file: $("#sup-lla-app").attr('src')
              foc_per_file: $("#per-foc-app").attr('src')
              foc_lat_file: $("#lat-foc-app").attr('src')
              foc_sup_file: $("#sup-foc-app").attr('src')
          dataType: "json"
          success: (data) ->
             window.location = data.location
     #       alert data
  return

actualizar_custom = ->
  $.ajax
          type: 'PATCH'
          url: gon.update_path # custom_actualiza_path #variable definida en _customapp.html.erb con el path para crear una nueva CustomApp 
          data:
            custom_app:
              est_per_file: $("#per-est-app").attr('src')
              est_lat_file: $("#lat-est-app").attr('src')
              est_sup_file: $("#sup-est-app").attr('src')
              apl_per_file: $("#per-apl-app").attr('src')
              apl_lat_file: $("#lat-apl-app").attr('src')
              apl_sup_file: $("#sup-apl-app").attr('src')
              asi_per_file: $("#per-asi-app").attr('src')
              asi_lat_file: $("#lat-asi-app").attr('src')
              asi_sup_file: $("#sup-asi-app").attr('src')
              man_per_file: $("#per-man-app").attr('src')
              man_lat_file: $("#lat-man-app").attr('src')
              man_sup_file: $("#sup-man-app").attr('src')
              lla_per_file: $("#per-lla-app").attr('src')
              lla_lat_file: $("#lat-lla-app").attr('src')
              lla_sup_file: $("#sup-lla-app").attr('src')
              foc_per_file: $("#per-foc-app").attr('src')
              foc_lat_file: $("#lat-foc-app").attr('src')
              foc_sup_file: $("#sup-foc-app").attr('src')
          dataType: "json"
          success: (data) ->
             window.location = data.location
  return

cargar_cambios = (data) ->
  nuevaParte '#per-est-app', data['est_pf']
  nuevaParte '#lat-est-app', data['est_lf']
  nuevaParte '#sup-est-app', data['est_sf']
  nuevaParte '#per-apl-app', data['apl_pf']
  nuevaParte '#lat-apl-app', data['apl_lf']
  nuevaParte '#per-asi-app', data['asi_pf']
  nuevaParte '#lat-asi-app', data['asi_lf']
  nuevaParte '#sup-asi-app', data['asi_sf']
  nuevaParte '#per-man-app', data['man_pf']
  nuevaParte '#lat-man-app', data['man_lf']
  nuevaParte '#sup-man-app', data['man_sf']

